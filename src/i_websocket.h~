#define CONNECTING = 0 ;
#define OPEN = 1 ;
#define CLOSING = 2 ;
#define CLOSED = 3 ;

typedef struct _ws_event {

  char *data ;

} ws_event ;

typedef struct _web_socket {

  /*
    Functions to be implemented by concrete implementations
   */

  int (*on_open)( struct _web_socket *self ) ;
  int (*on_message)( struct _web_socket *self, struct _ws_event *event ) ;
  int (*on_close)( struct _web_socket *self ) ;
  int (*on_error)( struct _web_socket *self ) ;

  /*
    Websocket API, from http://www.w3.org/TR/websockets/
   */

  void (*binary_type)( struct _web_socket *self, char *type ) ;
  void (*init)( struct _web_socket *self, char *ws_uri, char **protocols ) ;
  
  /* 
     @@TODO: Add other methods (and a struct for message) for sending
     binary data
   */

  void (*send)( struct _web_socket *self, char *message ) ;

  void (*close)( struct _web_socket *self ) ;

  char *_url ;

  short _ready_state ;
  long _buffered_amount ;
  char * _protocol ;
  
} web_socket;
